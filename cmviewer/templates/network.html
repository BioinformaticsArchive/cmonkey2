<!doctype html>
<html>
  <head>
    <title>CMViewer - Network view for {{species}}</title>
    <script src="/static/javascripts/jquery-2.1.1.min.js" type="text/javascript"></script>
    <script src="/static/javascripts/cytoscape.min.js" type="text/javascript"></script>
    <script src="/static/javascripts/springy.js" type="text/javascript"></script>
    <style id="jsbin-css">
      body {
        font: 14px helvetica neue, helvetica, arial, sans-serif;
      }
      #cy {
        height: 100%;
        width: 100%;
        position: absolute;
        left: 10;
        top: 10;
      }
    </style>
    <script>
      $(document).ready(function() {
        var nodeData = [];
        for (var i = 0; i < {{num_clusters}}; i++) {
          var cluster = i + 1;
          nodeData[i] = { classes: 'clusters', data: { id: cluster.toString(), name: cluster.toString() } };
        };
        var genes = [
          {% for gene in genes %}{ classes: 'genes', data: { id: '{{gene}}', name: '{{gene}}' } },
          {% endfor %}
        ];
        nodeData = nodeData.concat(genes);
        var motifs = [
          {% for motif in motifs %}{ classes: 'motifs', data: { id: 'm{{motif[0]}}', name: '{{motif[1]}}_{{motif[2]}}' } },
          {% endfor %}
        ];
        nodeData = nodeData.concat(motifs);

        var edgeData = [
          {% for gene, cluster in edges %}{ data: { source: '{{gene}}', target: '{{cluster}}' } },
          {% endfor %}
        ];

        $('#cy').cytoscape({
          style: cytoscape.stylesheet()
            .selector('node').css({
              'content': 'data(name)',
              'text-valign': 'center',
              'color': 'black',
              'min-zoomed-font-size': 7
            })
            .selector('edge').css({
              'target-arrow-shape': 'none',
              'curve-style': 'haystack'
            })
            .selector('.clusters').css({
              'color': 'green', 'background-color': 'red',
              'width': 10, 'height': 10, 'font-size': '8'
            })
            .selector('.genes').css({
              'width': 5, 'height': 5, 'font-size': '3'
            })
            .selector('.motifs').css({
              'width': 5, 'height': 5, 'font-size': '3', 'shape': 'triangle',
              'background-color': 'green'
            })
            .selector(':selected').css({
              'background-color': 'black',
              'line-color': 'black',
            })
            .selector('.faded').css({
              'opacity': 0.25,
              'text-opacity': 0
            }),
          elements: {
            nodes: nodeData,
            edges: edgeData
          },
          layout: { name: 'springy', animate: false, fit: true },
          ready: function() {
            window.cy = this;
            cy.elements().unselectify();
            cy.on('tap', 'node', function(e) {
              var node = e.cyTarget;
              var neighborhood = node.neighborhood().add(node);
              cy.elements().addClass('faded');
              neighborhood.removeClass('faded');
            });
            cy.on('tap', function(e) {
              if (e.cyTarget === cy) {
                cy.elements().removeClass('faded');
              }
            });
          },
          pixelRatio: 1.0,
          hideEdgesOnViewport: true,
          hideLabelsOnViewport: true,
          textureOnViewport: true
        });
      }); // on dom ready
</script>

  </head>
<body>
  <h2>Network view of {{species}} at iteration {{iteration}}</h2>
  <div id="container">
    <div id="cy"></div>
  </div>
</body>
</html>
