@(iteration: Int, cluster: Int, rows: List[String], columns: List[String],
  ratios: RatioMatrix, motifInfoMap: Map[String, Array[MotifInfo]],
  pssmMap: Map[String, Array[String]],
  annotationMap: Map[String, Seq[GeneAnnotations]],
  gagglePSSMs: Map[String, Array[String]], species: String)

<div id="cluster-view">
  <script type="text/javascript">
    @motifInfoMap.keys.map { seqType =>
      @for(i <- 0 until pssmMap(seqType).length) {
        var pssm@(seqType)_@i = @Html(pssmMap(seqType)(i));
      }
    }
    var canvasOptions = {
        width: 300,
        height: 150,
        glyphStyle: '20pt Helvetica'
    };
    function toggleExpandCollapse(text) {
      return text == "(...)" ? "Hide" : "(...)";
    }

    $(document).ready(function() {
        var chart1 = new Highcharts.Chart({
            chart: {
                renderTo: 'expression-graph',
                type: 'line',
                height: 250
            },
            title: {
                text: 'Gene Expressions'
            },
            plotOptions: { line: { marker: { enabled: false } } },
            yAxis: {
                title: {
                    text: 'log10'
                }
            },
            series: @Html(HighchartsFormatter.toHSSeries(ratios))
        });
        @motifInfoMap.keys.map { seqType =>
          @for(i <- 0 until pssmMap(seqType).length) {
            isblogo.makeLogo('canvas@(seqType)_@i', pssm@(seqType)_@i, canvasOptions);
          }
        }
        @motifInfoMap.keys.map { seqType =>
        var annotations_@seqType = [
            @for(i <- 0 until annotationMap(seqType).length) {

            {
                gene: '@(annotationMap(seqType)(i).gene)', condition: '',
                log10: -0.17,
                boxColor: '#08f',
                lineColor: '#000',
                matches: [
                    @for(j <- 0 until annotationMap(seqType)(i).annotations.length) {
                        @defining(annotationMap(seqType)(i).annotations(j)) { annotation =>
                                                                   { motif: @(annotation.motifNum - 1), start: @(annotation.position), length: @motifInfoMap(seqType)(annotation.motifNum - 1).pssm.length, reverse: @(annotation.reverse), score: @(annotation.pvalue) },
                                                                 }
                    }
                ]
            },

            }
        ];
        annot.draw('annotation-graph_@seqType', { width: 500, height: 400, annotations: annotations_@seqType});
        }
        $('#toggle-row-members').click(function() {
          $('#toggle-row-members').text(toggleExpandCollapse($('#toggle-row-members').text()));
          $('#row-members').toggle();
          return false;
        });
        $('#toggle-col-members').click(function() {
          $('#toggle-col-members').text(toggleExpandCollapse($('#toggle-col-members').text()));
          $('#column-members').toggle();
          return false;
        });
    });
  </script>
  <h2>Cluster @cluster at iteration @iteration</h2>
  <h3>Cluster memberships</h3>
  <br>
  <div id="cluster-members" style="width: 600px">
    <div><span class="h4">Row members (@(rows.length))</span> <a id="toggle-row-members" href="#">(...)</a></div>
    <div id="row-members" style="display:none">@(rows.mkString(", "))</div>
    <div><span class="h4">Column members (@(columns.length))</span> <a id="toggle-col-members" href="#">(...)</a></div>
    <div id="column-members" style="display:none">@(columns.mkString(", "))</div>
  </div>
  <br>
  <div id="expression-graph"></div>
  <div>&nbsp;</div><br>
  <h3>Motifs</h3>
  @if(motifInfoMap.size == 0) {
    No motif information available for this cluster/iteration
  }
  @motifInfoMap.keys.map { seqType =>
  @for(i <- 0 until pssmMap(seqType).length) {
    <span style="display: inline; float: left; margin-right: 10px;">
    <div>Sequence type: @seqType, motif @i, evalue: @(motifInfoMap(seqType)(i).evalue)</div>
    <div id="canvas@(seqType)_@i"></div>
    </span>
  }
  }
  <div style="clear: both"></div><br>
  @motifInfoMap.keys.map { seqType =>
  <h3>Annotations for @seqType</h3>
  <div id="annotation-graph_@seqType"></div>
  }
  <div style="clear: both"></div>
  <div>&nbsp;</div>
</div>

<br><br>
<!-- Gaggle microformats embedded here -->

<div class="gaggle-data" style="display:none">
  <span class="gaggle-name">Row members cluster @cluster</span>
  <span class="gaggle-species">@species</span>
  <span class="gaggle-namelist">
    <ol>
      @for(name <- rows) {
      <li>@name</li>
      }
    </ol>
  </span>
</div>
<div class="gaggle-data" style="display:none">
  <span class="gaggle-name">Column members cluster @cluster</span>
  <span class="gaggle-species">@species</span>
  <span class="gaggle-namelist">
    <ol>
      @for(name <- columns) {
      <li>@name</li>
      }
    </ol>
  </span>
</div>

@motifInfoMap.keys.map { seqType =>
  @for(i <- 0 until gagglePSSMs(seqType).length) {
  <div class="gaggle-data" style="display:none">
    <span class="gaggle-name">PSSM (@seqType) motif @(i + 1)</span>
    <span class="gaggle-species">@species</span>
    <span class="gaggle-description">PSSM (@seqType) motif @(i + 1) for @species</span>
    <span class="gaggle-matrix-tsv">
      @(gagglePSSMs(seqType)(i))
    </span>
  </div>
  }
}
